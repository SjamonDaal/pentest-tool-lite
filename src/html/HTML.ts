import Test from '../Test';
import CSS from './CSS';
import Image from './Image';
import JavaScript from './JavaScript';

class HTML extends Test {
  protected factory: IFactory;

  constructor(factory: IFactory, config: any) {
    super(config);
    this.factory = factory;
  }

  public async run(url: string): Promise<IResult> {
    const request = this.factory.getRequest();
    const parseHTML = this.factory.getParseHTML();
    const getResources = this.factory.getGetResources();
    const logger = this.factory.getLogger();

    const results = [
      await this.runTest('css', new CSS(request, parseHTML, getResources, logger), url),
      await this.runTest('javascript', new JavaScript(request, parseHTML, getResources, logger), url),
      await this.runTest('image', new Image(request, parseHTML, getResources, logger), url),
    ].filter((test) => test !== null);

    return this.getResult('HTML', this.getStatus(results), results);
  }
}

export default HTML;
