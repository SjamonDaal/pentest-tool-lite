import {
  getResources,
  parseHtml,
} from '../functions';
import Logger from './Logger';
import Request from './Request';
import BlackHoleCache from './request/BlackHoleCache';
import UnlimitedCache from './request/UnlimitedCache';

const defaultConfig = {
  logger: {
    level: 'ERROR',
  },
  request: {
    cache: {
      type: 'UNLIMITES',
    },
  },
};

class Factory implements FactoryInterface {
  protected config: any;

  protected request: RequestInterface = null;

  protected logger: LoggerInterface = null;

  constructor(config: any = defaultConfig) {
    this.config = config;
  }

  public getRequest(): RequestInterface {
    if (this.request === null) {
      const cache = this.config.request.cache.type === 'UNLIMITED' ? new UnlimitedCache() : new BlackHoleCache();
      this.request = new Request(cache, this.getLogger());
    }
    return this.request;
  }

  public getLogger(): LoggerInterface {
    if (this.logger === null) {
      this.logger = new Logger(this.config.logger.level);
    }
    return this.logger;
  }

  public getParseHTML(): (result: any) => Promise<any> {
    return parseHtml;
  }

  public getGetResources(): (result: any) => string[] {
    return getResources;
  }
}

export default Factory;
